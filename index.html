 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>محول العملات الفوري</title>
<style>
    body {
        font-family: sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
        text-align: center;
    }
    .box {
        background: #fff;
        padding: 20px;
        margin: auto;
        max-width: 450px;
        border-radius: 15px;
        box-shadow: 0 0 15px #0002;
    }
    input, select, button {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        border-radius: 10px;
        border: 1px solid #ccc;
        font-size: 16px;
    }
    button {
        background: #0a84ff;
        color: white;
        cursor: pointer;
    }
</style>
</head>
<body>

<h2>محول العملات الفوري — يعمل 100%</h2>

<div class="box">

    <label>المبلغ</label>
    <input id="amount" type="number" value="1">

    <label>من</label>
    <select id="from"></select>

    <label>إلى</label>
    <select id="to"></select>

    <button onclick="doConvert()">تحويل الآن</button>

    <h3 id="result">النتيجة: -</h3>
    <h4 id="rate">سعر الصرف: -</h4>
    <small id="update">آخر تحديث: -</small>

</div>

<script>
const amountEl = document.getElementById("amount");
const fromEl   = document.getElementById("from");
const toEl     = document.getElementById("to");
const resultEl = document.getElementById("result");
const rateEl   = document.getElementById("rate");
const updateEl = document.getElementById("update");


// --- 1) تحميل العملات ---
async function loadSymbols() {
    try {
        const res = await fetch("https://api.exchangerate.host/symbols");
        const data = await res.json();

        const symbols = Object.keys(data.symbols);

        symbols.forEach(s => {
            fromEl.innerHTML += `<option value="${s}">${s}</option>`;
            toEl.innerHTML   += `<option value="${s}">${s}</option>`;
        });

        fromEl.value = "USD";
        toEl.value   = "SAR";

    } catch (e) { 
        console.error("Error loading symbols", e); 
    }
}


// --- 2) التحويل ---
async function doConvert() {
    const amount = Number(amountEl.value);
    const from   = fromEl.value;
    const to     = toEl.value;

    if (!amount || amount <= 0) {
        resultEl.textContent = "أدخل مبلغًا صحيحًا";
        return;
    }

    const url = `https://api.exchangerate.host/convert?from=${from}&to=${to}&amount=${amount}`;

    try {
        const res = await fetch(url);
        const data = await res.json();

        const rate = data.info.rate;
        const converted = data.result;

        resultEl.textContent = `النتيجة: ${converted} ${to}`;
        rateEl.textContent   = `سعر الصرف: 1 ${from} = ${rate} ${to}`;
        updateEl.textContent = new Date().toLocaleString();

    } catch (e) {
        resultEl.textContent = "خطأ في التحويل";
        console.error("convert error", e);
    }
}


// --- 3) تأكد من تحميل العملات أولًا ثم بدء العمل ---
(async()=>{
    await loadSymbols();   // ← أهم خطوة
    doConvert();           // يبدأ فقط بعد تحميل العملات
})();
</script>

</body>
</html>
